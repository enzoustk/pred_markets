<div class="container">
    <div class="header-section">
        <h1>Detailed Analysis: {{tag_name}}</h1>
        <p class="subtitle">Insights and analytics for {{tag_name}}</p>
        <div class="nav-links">
            <a href="../index.html" class="nav-link">‚Üê Back to Overview</a>
            <a href="../tags.html" class="nav-link">‚Üê Back to All Tags</a>
            <a href="{{apostas_filename}}" class="nav-link highlight">üìã Ver Todas as Apostas</a>
        </div>
    </div>
    
    <!-- Primeiras Informa√ß√µes: M√©tricas Principais -->
    <div class="metrics-main-container">
        {{metrics_main_html}}
    </div>
    
    <div class="chart-section-wrapper">
        <div class="chart-section">
            <div class="chart-controls">
                <label for="daily-period">Filtrar por per√≠odo:</label>
                <select id="daily-period">
                    <option value="all">Total</option>
                    <option value="year">√öltimo Ano</option>
                    <option value="6months">√ölt. 6 Meses</option>
                    <option value="month">√ölt M√™s</option>
                    <option value="15days">√öltimos 15 Dias</option>
                    <option value="7days">√öltimos 7 Dias</option>
                    <option value="custom">Personalizado</option>
                </select>
                <div id="daily-custom-dates" style="display: none;">
                    <label for="daily-start-date">Data In√≠cio:</label>
                    <input type="date" id="daily-start-date">
                    <label for="daily-end-date">Data Fim:</label>
                    <input type="date" id="daily-end-date">
                </div>
            </div>
            <div class="chart-container" id="daily-chart-container">
                {{chart_html}}
            </div>
        </div>
        
        <div class="clv-analysis-section">
            <div class="clv-content" id="clv-content">
                <h3>CLV Analysis</h3>
                <p>Request a in-depth CLV Analysis for past bets.</p>
                <button id="request-clv-btn" class="clv-button">Request CLV Analysis</button>
                
                <!-- Barra de carregamento (inicialmente oculta) -->
                <div id="clv-loading" class="clv-loading" style="display: none;">
                    <div class="clv-loading-bar">
                        <div class="clv-loading-progress"></div>
                    </div>
                    <p class="clv-loading-text">Analyzing CLV data...</p>
                </div>
                
                <!-- Resultados do CLV (inicialmente oculta) -->
                <div id="clv-results" class="clv-results" style="display: none;">
                    <div class="clv-stats-grid">
                        <div class="clv-stat-card">
                            <div class="clv-stat-label">CLV+ %</div>
                            <div class="clv-stat-value" id="clv-positive-percent">-</div>
                        </div>
                        <div class="clv-stat-card">
                            <div class="clv-stat-label">CLV 0 %</div>
                            <div class="clv-stat-value" id="clv-zero-percent">-</div>
                        </div>
                        <div class="clv-stat-card">
                            <div class="clv-stat-label">CLV - %</div>
                            <div class="clv-stat-value" id="clv-negative-percent">-</div>
                        </div>
                    </div>
                    
                    <div class="clv-details">
                        <div class="clv-detail-row">
                            <span class="clv-detail-label">Avg CLV (Percent):</span>
                            <span class="clv-detail-value" id="avg-clv-percent">-</span>
                        </div>
                        <div class="clv-detail-row">
                            <span class="clv-detail-label">Median CLV (Percent):</span>
                            <span class="clv-detail-value" id="median-clv-percent">-</span>
                        </div>
                        <div class="clv-detail-row">
                            <span class="clv-detail-label">Avg CLV (Odds):</span>
                            <span class="clv-detail-value" id="avg-clv-odds">-</span>
                        </div>
                        <div class="clv-detail-row">
                            <span class="clv-detail-label">Median CLV (Odds):</span>
                            <span class="clv-detail-value" id="median-clv-odds">-</span>
                        </div>
                    </div>
                    
                    <button id="view-clv-by-date-btn" class="clv-view-button">View CLV by Date</button>
                </div>
            </div>
        </div>
    </div>
    
    {{chart_animation_css}}
    
    <script>
        const dailyChartData = {{chart_data_json}};
        const allDailyData = {{all_data_json}};
        const userAddress = '{{user_address}}';
        const dfTagData = {{df_tag_json}};
        
        {{chart_js}}
        
        // Sincronizar altura do gr√°fico e se√ß√£o CLV
        function syncChartHeights() {
            const chartSection = document.querySelector('.chart-section');
            const clvSection = document.querySelector('.clv-analysis-section');
            
            if (chartSection && clvSection) {
                // Usar ResizeObserver para sincronizar quando o gr√°fico carregar
                const observer = new ResizeObserver(() => {
                    const chartHeight = chartSection.offsetHeight;
                    clvSection.style.height = chartHeight + 'px';
                });
                
                observer.observe(chartSection);
                
                // Sincronizar imediatamente
                setTimeout(() => {
                    const chartHeight = chartSection.offsetHeight;
                    clvSection.style.height = chartHeight + 'px';
                }, 100);
                
                // Sincronizar ap√≥s o Plotly carregar
                if (typeof Plotly !== 'undefined') {
                    Plotly.Plots.resize(document.getElementById('daily-chart')).then(() => {
                        const chartHeight = chartSection.offsetHeight;
                        clvSection.style.height = chartHeight + 'px';
                    });
                }
            }
        }
        
        // Executar quando o DOM estiver pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', syncChartHeights);
        } else {
            syncChartHeights();
        }
        
        // Re-executar ap√≥s um delay para garantir que o gr√°fico carregou
        setTimeout(syncChartHeights, 500);
        setTimeout(syncChartHeights, 1000);
    </script>
    
    <script>
        {{clv_analysis_js}}
        
        // Inicializar CLV Analysis ap√≥s o script ser carregado
        initCLVAnalysis('{{tag_name}}');
    </script>
    
    <div class="dashboard-grid">
        <div class="dashboard-left-column">
            <div class="dashboard-section combined-tables">
                <div class="table-subsection">
                    <h4>Metrics</h4>
                    <div class="dashboard-table-container">
                        {{metrics_table_html}}
                    </div>
                </div>
                <div class="table-subsection">
                    <h4>Stake Distribution</h4>
                    <div class="dashboard-table-container">
                        {{stake_distribution_table_html}}
                    </div>
                </div>
            </div>
        </div>
        <div class="dashboard-right-column">
            <div class="dashboard-section daily-summary">
                <h3>Daily Summary</h3>
                <div class="dashboard-table-container">
                    {{daily_summary_table_html}}
                </div>
            </div>
        </div>
    </div>
</div>


